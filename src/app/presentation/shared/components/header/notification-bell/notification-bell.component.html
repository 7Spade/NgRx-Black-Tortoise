<!-- 
  ARCHITECTURAL COMPLIANCE:
  =========================
  ✅ Single viewModel() binding (no multiple signal reads)
  ✅ Stable DOM with [hidden] instead of structural @if
  ✅ No menu flicker during state changes
-->

<button
  mat-icon-button
  [matMenuTriggerFor]="notificationMenu"
  [matBadge]="facade.viewModel().unreadCount"
  [matBadgeHidden]="!facade.viewModel().hasUnread"
  matBadgeColor="warn"
  matBadgeSize="small"
  class="notification-bell"
  aria-label="Notifications"
>
  <mat-icon>notifications</mat-icon>
</button>

<mat-menu #notificationMenu="matMenu" class="notification-menu">
  <!-- Header -->
  <div class="menu-header">
    <h3>Notifications</h3>
    <button 
      mat-button 
      (click)="markAllAsRead()"
      [hidden]="!facade.viewModel().hasUnread">
      Mark all as read
    </button>
  </div>

  <mat-divider />

  <!-- Recent notifications -->
  <div 
    class="notifications-list"
    [hidden]="facade.viewModel().recentNotifications.length === 0">
    @for (notification of facade.viewModel().recentNotifications; track notification.id) {
      <button
        mat-menu-item
        class="notification-item"
        [class.unread]="!notification.read"
        (click)="markAsRead(notification.id)"
      >
        <div class="notification-content">
          <div class="notification-title">{{ notification.title }}</div>
          <div class="notification-message">{{ notification.message }}</div>
          <div class="notification-time">{{ notification.createdAt | date: 'short' }}</div>
        </div>
      </button>
    }
  </div>
  
  <!-- Empty state -->
  <div 
    class="empty-state"
    [hidden]="facade.viewModel().recentNotifications.length > 0">
    <mat-icon>notifications_none</mat-icon>
    <p>No notifications</p>
  </div>

  <mat-divider />

  <!-- View all -->
  <div class="menu-footer">
    <button mat-button (click)="viewAllNotifications()">View all notifications</button>
  </div>
</mat-menu>
